# WiX Knowledge Base Sources Configuration
# Each source defines where to harvest data from

version: "1.0"

sources:
  # XSD Schemas - Primary element/attribute definitions
  xsd:
    wix_core:
      url: "https://raw.githubusercontent.com/wixtoolset/wix/main/src/xsd/wix.xsd"
      parser: xsd
      targets: [elements, attributes]

    bal:
      url: "https://raw.githubusercontent.com/wixtoolset/wix/main/src/xsd/bal.xsd"
      parser: xsd
      targets: [elements, attributes]
      extension: bal

    util:
      url: "https://raw.githubusercontent.com/wixtoolset/wix/main/src/xsd/util.xsd"
      parser: xsd
      targets: [elements, attributes]
      extension: util

    netfx:
      url: "https://raw.githubusercontent.com/wixtoolset/wix/main/src/xsd/netfx.xsd"
      parser: xsd
      targets: [elements, attributes]
      extension: netfx

    ui:
      url: "https://raw.githubusercontent.com/wixtoolset/wix/main/src/xsd/ui.xsd"
      parser: xsd
      targets: [elements, attributes]
      extension: ui

  # ICE Rules - from MSDN documentation
  ice:
    msdn_ice:
      url: "https://learn.microsoft.com/en-us/windows/win32/msi/ice-reference"
      parser: html_parser
      targets: [ice_rules]

  # MSI Tables - from MSDN documentation
  msi:
    msi_tables:
      url: "https://learn.microsoft.com/en-us/windows/win32/msi/database-tables"
      parser: html_parser
      targets: [msi_tables]

  # Error Codes - curated (complex to scrape reliably)
  errors:
    wix_errors:
      path: "templates/wix-errors.json"
      parser: json
      targets: [errors]

    light_errors:
      path: "templates/light-errors.json"
      parser: json
      targets: [errors]

  # Lint Rules - Custom validation rules
  rules:
    component_rules:
      path: "templates/rules/component-rules.json"
      parser: rules
      targets: [rules]

    file_rules:
      path: "templates/rules/file-rules.json"
      parser: rules
      targets: [rules]

    directory_rules:
      path: "templates/rules/directory-rules.json"
      parser: rules
      targets: [rules]

    feature_rules:
      path: "templates/rules/feature-rules.json"
      parser: rules
      targets: [rules]

    property_rules:
      path: "templates/rules/property-rules.json"
      parser: rules
      targets: [rules]

    customaction_rules:
      path: "templates/rules/customaction-rules.json"
      parser: rules
      targets: [rules]

    service_rules:
      path: "templates/rules/service-rules.json"
      parser: rules
      targets: [rules]

    bundle_rules:
      path: "templates/rules/bundle-rules.json"
      parser: rules
      targets: [rules]

    registry_rules:
      path: "templates/rules/registry-rules.json"
      parser: rules
      targets: [rules]

    package_rules:
      path: "templates/rules/package-rules.json"
      parser: rules
      targets: [rules]

  # Snippets
  snippets:
    code_snippets:
      path: "templates/snippets.json"
      parser: json
      targets: [snippets]

  # Version Migration
  migrations:
    v3_to_v4:
      path: "templates/v3-v4-diff.json"
      parser: migration
      targets: [migrations]

  # MSI Reference Data - curated
  msi_reference:
    msi_properties:
      path: "templates/msi-properties.json"
      parser: json
      targets: [builtin_properties]

    standard_directories:
      path: "templates/standard-directories.json"
      parser: json
      targets: [standard_directories]

    standard_actions:
      path: "templates/standard-actions.json"
      parser: json
      targets: [standard_actions]

  # Syntax Data
  syntax:
    keywords:
      path: "templates/keywords.json"
      parser: json
      targets: [keywords]

    preprocessor:
      path: "templates/preprocessor.json"
      parser: json
      targets: [preprocessor_directives]

# Parser configurations
parsers:
  xsd:
    type: xml
    extract:
      - elements: "//xs:element[@name]"
      - attributes: "//xs:attribute[@name]"
      - types: "//xs:simpleType[@name]"

  json:
    type: json

  rules:
    type: json
    validate_schema: "schemas/rule.schema.json"

  html_parser:
    type: html

  migration:
    type: json

# Harvest settings
harvest:
  cache_dir: ".cache"
  timeout_seconds: 30
  retry_count: 3
  user_agent: "wixkb-harvester/1.0"

  # Rate limiting for web sources
  rate_limit:
    requests_per_second: 2
    burst: 5
